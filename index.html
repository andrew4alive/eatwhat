<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  
  <style>
  
  
  html, body {
        height: 100%;
        width:100%;
        margin: 0px;
        padding: 0px;
      }
    .main{
     height: 80%;
        width:100%;
         margin: 0px;
        padding: 0px;
      overflow:hidden;
    
    }
    .page{
    height: 100%;
    width:100%;
    }
   
     
        #rmapholder > iframe {
        min-height: 350px;;
        width:100%;
         margin:0px;
         padding:0px;

      }
  
  

      #log{
          
         display:none;
      }
</style>

</head>

<body>
    <nav class="navbar navbar-default navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="#">
       EatWhat?
      </a>
    </div>
  </div>
</nav>
  
 
    <div  class="container-fluid" id="log">
        
        log message :  <span id="logm"></span>
        
    </div>
  <div class="container-fliud main">
      
<div class="container page" id="mapp">
  
  <form class="form-horizontal" >
    <div class="form-group">
    
      <div class="col-sm-12">
    <input type="text" class="form-control" id="geoinpu" placeholder="Your Location" >
      </div>
      </div>
</form>    
    
    <div width="60%" height="100%"  style="width:100%;height:70%" id="map">
   
     
            <h1 class="animated infinite bounce" style="text-align:center;margin:auto;margin-top:10%;">Trying to locate you</h1>
   
  
      </div>
      <form>
        <button type="button"   data-toggle="modal" data-target="#myModal" class="col-xs-12 btn btn-primary btn-lg " style="margin-top:10px;margin-bottom:10px;" id="findrplace">Press Me</button>
  </form>
    </div>
   
   
  </div>
  <!-- Modal -->
  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body" >
          <div id="rmapholder" ></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="pickagain">Pick Again</button>
      </div>
    </div>
  </div>
</div>
  
  
  
  <!--javascript-->



  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>


  <script src="https://gitcdn.xyz/repo/andrew4alive/html5-geo/master/geo.js"></script>
  
  
  
  <script>
    
 var geol = new geo({maximunAge: 120000,timeOut:3000});
    
    function gc() {
  console.log(geol.coords,geol.error);
  setTimeout(gc, 10000);
}
    
 
function initMap(){
    
  
 var logm= document.getElementById("logm");
 
 logm.innerHTML="start log";
  var cord = {};
  

    
    if(geol.coords===null){
        return setTimeout(initMap,500);
      
    }else{
      
        coordController();
      
    }
      
    
 
  var map = new google.maps.Map(document.getElementById('map'), {
          center: mapcenter(),
          zoom:14 ,
          scrollwheel:false
  })
  map.setOptions({draggable: false});
  
  
   var markeryou = new google.maps.Marker({
    position: map.getCenter(),
    icon: {
      path: google.maps.SymbolPath.CIRCLE,
      scale: 5,
      strokeColor: 'blue',
    
    },
    draggable: false,
    map: map
  });
  
  updatemap();
  
  logm.innerHTML="seraching map";
  //map search
  var rplaceid=[];
  
  var nplaceid=[];
   var service = new google.maps.places.PlacesService(map);
  
 // var rmarker = new google.maps.Marker({map:map});

  //map.addListener('idle', mapFR);
  map.addListener('idle', mapFS);
  //nearby search function
  function mapFS(){
  
    service.nearbySearch(
      {//search param
        bounds:map.getBounds(),
        keyword:'eat',
        openNow:true
    
    
      },function(r,s,p){//start search
          if(s!==google.maps.places.PlacesServiceStatus.OK){// sheck status
            console.error(status);
            return;
          }
            // status ok 
          //console.log(r);
        var rs =[]
          if(p.hasNextPage){//inde]x page
            
                rs.push(r);     
               p.nextPage();
          }
        else{
          nplaceid=[];
          $.map(r,function(n){
          nplaceid.push( n);
          });
          console.log(nplaceid);
          var rmap=document.getElementById('rmapholder');
          var rplace1 = rplace(nplaceid);
        
         createrplace(rmap,rplace1.place_id);
          
        
        
        }
        
        
    });//end search 
    
  
  }
  // end nearby search function
  
  
  //rador search
  
  function mapFR(){
  
  logm.innerHTML="finding";
  
      
        service.radarSearch({
          bounds: map.getBounds(),
          keyword: 'eat'
        }, cb);
      
    
  function cb(results, status) {
      
      
        if (status !== google.maps.places.PlacesServiceStatus.OK) {
          console.error(status);
          logm.innerHTML="fail to find map";
          return;
        }
        
        logm.innerHTML="result find success";

        
    
      
    
                                                                    
          function startrplace(results,rmarker){//console log function 
        
          console.log(results,results.length,typeof(results),rplace(results));
           console.log(results[0].geometry.location,rmaker);
        
          }
         
        
        
        
          var rmap=document.getElementById('rmapholder');
          var rplace1 = rplace(results);
        
         createrplace(rmap,rplace1.place_id);
      
          document.getElementById('pickagain').onclick=function(){
            var rmap=document.getElementById('rmapholder');
            var rplace1 = rplace(results);
        
              createrplace(rmap,rplace1.place_id);
            };
    
    
          function letgo(ele,rid){// let go button
            var uc=markeryoucenter();
            ele.onclick=function(){
             window.open('https://www.google.com.my/maps/dir'+uc.lat+','+uc.lng+'/'+'place_id:'+rid);
           };
      }
    
    
      
    }
  //radar search end
  }
  

  
  
  //helper
  
  
    function rplace(r){
          var pplaceId = Math.floor(Math.random()*r.length);
          return r[pplaceId];
      }
       function createrplace(ele,rid){
           var iframe='<iframe  frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/place?key=AIzaSyBWu5ezWN1HrruH3LXGI1L9JjcmQmX-Mks&q=';
          
         iframe = iframe +'place_id:'+rid+'"allowfullscreen></iframe>';
           ele.innerHTML=iframe;
        
       }
  
   function createrdir(ele,rid){
           var iframe='<iframe  frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/directions?key=AIzaSyBWu5ezWN1HrruH3LXGI1L9JjcmQmX-Mks&origin=';
          var ori = markeryoucenter();
         iframe = iframe + ori.lat+','+ori.lng;
         iframe = iframe +'&destination=place_id:'+rid+'"allowfullscreen></iframe>';
           ele.innerHTML=iframe;
       }
  
  
  
  
  function updatemap(){
    
   markeryou.setPosition(markeryoucenter());
    map.setCenter(mapcenter()); 
   setTimeout(updatemap,300); 
    
  };
 
  function coordController(){
   
     cord.latitude=geol.coords.latitude;
      cord.longitude=geol.coords.longitude;
      // console.log(typeof(cord.latitude));
    setTimeout(coordController,0);
    
  }
  
  function markeryoucenter(){
      var lat =round(cord.latitude,5);
      var lng =round(cord.longitude,5);
      return {lat: lat, lng:lng};
      
  }
  
  function mapcenter(){
     // console.log( round(cord.latitude,4) , typeof(cord.latitude) );
      var dec=3
      var lat =round(cord.latitude,3);
      var lng =round(cord.longitude,3);
      return {lat: lat, lng:lng};
      
  }
  
  

  
  

      
 function round(value, decimals) {
  return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
}
  
      
}    
  </script>
  
  
  <script async defer 
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCR-fcDARXL_RqH9AipjGChFIpLDL5lOR8&callback=initMap&libraries=places,visualization">
  
</script>





</body>

</html>
  
